"use strict";(self.webpackChunksauce_docs=self.webpackChunksauce_docs||[]).push([[32596],{44449:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var t=i(74848),s=i(28453);i(86025);const r={id:"best-practices",title:"Best Practices",sidebar_label:"Best Practices"},a=void 0,o={id:"orchestrate/best-practices",title:"Best Practices",description:"This page describes best practices for using container images in Sauce Orchestrate.",source:"@site/docs/orchestrate/best-practices.md",sourceDirName:"orchestrate",slug:"/orchestrate/best-practices",permalink:"/sauce-docs/pr-preview/pr-2916/orchestrate/best-practices",draft:!1,unlisted:!1,editUrl:"https://github.com/saucelabs/sauce-docs/edit/main/docs/orchestrate/best-practices.md",tags:[],version:"current",lastUpdatedBy:"kristofmuhi",lastUpdatedAt:172492915e4,frontMatter:{id:"best-practices",title:"Best Practices",sidebar_label:"Best Practices"},sidebar:"docs",previous:{title:"Authenticated Pulls",permalink:"/sauce-docs/pr-preview/pr-2916/orchestrate/authenticated-pulls"},next:{title:"Using Sauce Connect",permalink:"/sauce-docs/pr-preview/pr-2916/orchestrate/sauce-connect"}},c={},l=[{value:"Building Efficient Java Images",id:"building-efficient-java-images",level:2},{value:"Ensure Proper Base Image",id:"ensure-proper-base-image",level:3},{value:"Bundle all Dependencies in Your Image",id:"bundle-all-dependencies-in-your-image",level:3},{value:"Add Maven settings.xml file",id:"add-maven-settingsxml-file",level:3},{value:"Handling Sensitive Data",id:"sensitive-data",level:2},{value:"Troubleshooting Issues Locally",id:"troubleshooting-issues-locally",level:2},{value:"Sauce Credentials",id:"sauce-credentials",level:2}];function d(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"This page describes best practices for using container images in Sauce Orchestrate."}),"\n",(0,t.jsx)(n.h2,{id:"building-efficient-java-images",children:"Building Efficient Java Images"}),"\n",(0,t.jsx)(n.p,{children:"Java is one of the most popular programming languages available and is widely used for Selenium and Appium test projects. Here are some tips and tricks to get your Java project working with Sauce Orchestrate. For this documentation page we will assume that Docker is being used."}),"\n",(0,t.jsx)(n.h3,{id:"ensure-proper-base-image",children:"Ensure Proper Base Image"}),"\n",(0,t.jsxs)(n.p,{children:["The best practice for creating a container image is to start with a base image. When building Java images you will want to choose a base image that contains the proper JDK and Maven version your project requires. There are many available base images to choose from. In our sample Java repository you can see we have chosen ",(0,t.jsx)(n.code,{children:"FROM maven:3.6.3-jdk-8"}),". This means we will use JDK 8 and Maven 3.6.3."]}),"\n",(0,t.jsx)(n.p,{children:"In order to know which JDK and Maven version to choose run the following commands on your local environment where you know your tests run successfully."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'java --version\nopenjdk 17.0.5 2022-10-18\nOpenJDK Runtime Environment Temurin-17.0.5+8 (build 17.0.5+8)\nOpenJDK 64-Bit Server VM Temurin-17.0.5+8 (build 17.0.5+8, mixed mode, sharing)\n\nmvn -v\nApache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f)\nMaven home: /usr/local/Cellar/maven/3.6.3_1/libexec\nJava version: 15.0.1, vendor: N/A, runtime: /usr/local/Cellar/openjdk/15.0.1/libexec/openjdk.jdk/Contents/Home\nDefault locale: en_US, platform encoding: UTF-8\nOS name: "mac os x", version: "10.16", arch: "x86_64", family: "mac"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"bundle-all-dependencies-in-your-image",children:"Bundle all Dependencies in Your Image"}),"\n",(0,t.jsx)(n.p,{children:"A major benefit of using container images is that all dependencies can be included in the image. This means your tests can run faster because they do not need to include the step of downloading dependencies. This can also be important if you have dependencies located in a private maven repository."}),"\n",(0,t.jsx)(n.p,{children:"In order to download all dependencies as part of building your image add the following lines to the end of your Dockerfile"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:"showLineNumbers",children:'ENV MAVEN_CONFIG "$USER_HOME_DIR/.m2"\nRUN mvn clean test; exit 0\n'})}),"\n",(0,t.jsxs)(n.p,{children:["To realize the performance gain from doing this, in your ",(0,t.jsx)(n.code,{children:"entrypoint"})," command configuration in saucectl make sure to run Maven in offline mode."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"  entrypoint: mvn test -o\n"})}),"\n",(0,t.jsx)(n.h3,{id:"add-maven-settingsxml-file",children:"Add Maven settings.xml file"}),"\n",(0,t.jsx)(n.p,{children:"Maven includes support for a global settings file. This is normally used to configure global dependencies and registry locations. If your project requires the global settings.xml file be present then you must ensure that file exists in your container image."}),"\n",(0,t.jsxs)(n.p,{children:["The Maven settings.xml file is generally found in the home directory of your local dev environment. In order to copy the settings.xml file located in your home directory you need to update your Dockerfile and where you run the ",(0,t.jsx)(n.code,{children:"docker build"})," command from."]}),"\n",(0,t.jsx)(n.p,{children:"Add the following to your Dockerfile:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:"showLineNumbers",children:"COPY ~/.m2/settings.xml ~/.m2\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Then run ",(0,t.jsx)(n.code,{children:"docker build"})," from your home directory:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ~\ndocker build -t [docker_user]]/sample-image:0.0.1 -f [path/to/Dockerfile]\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["Replace ",(0,t.jsx)(n.code,{children:"[docker_user]"})," with your Dockerhub username. Replace ",(0,t.jsx)(n.code,{children:"[path/to/Dockerfile]"})," with the location of your project's Dockerfile."]})}),"\n",(0,t.jsx)(n.h2,{id:"sensitive-data",children:"Handling Sensitive Data"}),"\n",(0,t.jsxs)(n.p,{children:["Sauce Orchestrate has multiple ways to use sensitive data in your container. The first is through the ",(0,t.jsx)(n.code,{children:"files"})," configuration."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"files"})," enables you to upload files into your running container rather than include them in your image. This is recommended for any test data and any settings needed for your team framework. A common use case for this is to include settings file such as an AWS configuration file with sensitive credentials in it."]}),"\n",(0,t.jsxs)(n.p,{children:["To upload files onto the container use the ",(0,t.jsx)(n.code,{children:"files"})," configuration option in your saucectl config.yml"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:"showLineNumbers",children:'apiVersion: v1alpha\nkind: imagerunner\nsauce:\n  region: us-west-1\nsuites:\n  - name: Desktop Tests\n    workload: webdriver\n    image: [docker_user]/demo-java-orchestrate-tutorial:0.0.1\n    # the command to run your tests\n    entrypoint: mvn -o test -pl best-practice -Dtest=DesktopTests\n    # files to be injected into the running container\n    files:\n      - src: "~/.aws/credentials"\n        dst: "/root/.aws"\n    artifacts:\n      - "/workdir/best-practice/target/surefire-reports/*"\n\nartifacts:\n  download:\n    when: always\n    match:\n      - "*"\n    directory: ./artifacts\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Another way to handle sensitive data is through the ",(0,t.jsx)(n.code,{children:"env"})," configuration option. This inserts environment variables into the running container."]}),"\n",(0,t.jsxs)(n.p,{children:["To insert environment variables use the ",(0,t.jsx)(n.code,{children:"env"})," configuration option in your saucectl config.yml"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:"showLineNumbers",children:'apiVersion: v1alpha\nkind: imagerunner\nsauce:\n  region: us-west-1\nsuites:\n  - name: Desktop Tests\n    workload: webdriver\n    image: [docker_user]/demo-java-orchestrate-tutorial:0.0.1\n    # the command to run your tests\n    entrypoint: mvn -o test -pl best-practice -Dtest=DesktopTests\n    # environment variables to be injected\n    env:\n      KEY: val\n    artifacts:\n      - "/workdir/best-practice/target/surefire-reports/*"\n\nartifacts:\n  download:\n    when: always\n    match:\n      - "*"\n    directory: ./artifacts\n'})}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting-issues-locally",children:"Troubleshooting Issues Locally"}),"\n",(0,t.jsx)(n.p,{children:"If you run into issues running your image in Sauce Orchestrate and the logs/artifacts are not helpful enough, then the next step to take is to run the image locally to make sure everything works. When running the image locally we first need to start the container with a shell open."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker run -it --entrypoint sh [docker_user]/[sample_image]\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["Replace ",(0,t.jsx)(n.code,{children:"[docker_user]"})," with your username and ",(0,t.jsx)(n.code,{children:"[sample_image]"})," with the name of your image."]})}),"\n",(0,t.jsx)(n.p,{children:"This command will start a container based on your specified image with a shell open. From here you can try to run your entrypoint command and navigate around the contents of your image."}),"\n",(0,t.jsx)(n.h2,{id:"sauce-credentials",children:"Sauce Credentials"}),"\n",(0,t.jsx)(n.p,{children:"It is highly recommended to not hardcode your Sauce Credentials in your test scripts. For convenience purposes we automatically inject your Sauce Credentials into the running Sauce Orchestrate container under the following environment variable names:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"SAUCE_USERNAME"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"SAUCE_ACCESS_KEY"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var t=i(96540);const s={},r=t.createContext(s);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);