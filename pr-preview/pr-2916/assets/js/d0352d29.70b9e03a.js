"use strict";(self.webpackChunksauce_docs=self.webpackChunksauce_docs||[]).push([[83702],{62421:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var c=o(74848),t=o(28453);const s={id:"docker",title:"Sauce Connect Proxy Docker Container",sidebar_label:"Docker"},r=void 0,i={id:"secure-connections/sauce-connect/setup-configuration/docker",title:"Sauce Connect Proxy Docker Container",description:"As an alternative to downloading and installing the Sauce Connect Proxy in your CI/CD environment, you can leverage Docker to manage Sauce Connect Docker container maintained by the Sauce Labs Open Source Program Office.",source:"@site/docs/secure-connections/sauce-connect/setup-configuration/docker.md",sourceDirName:"secure-connections/sauce-connect/setup-configuration",slug:"/secure-connections/sauce-connect/setup-configuration/docker",permalink:"/sauce-docs/pr-preview/pr-2916/secure-connections/sauce-connect/setup-configuration/docker",draft:!1,unlisted:!1,editUrl:"https://github.com/saucelabs/sauce-docs/edit/main/docs/secure-connections/sauce-connect/setup-configuration/docker.md",tags:[],version:"current",lastUpdatedBy:"kristofmuhi",lastUpdatedAt:172492915e4,frontMatter:{id:"docker",title:"Sauce Connect Proxy Docker Container",sidebar_label:"Docker"},sidebar:"docs",previous:{title:"Specialized Environment Setups",permalink:"/sauce-docs/pr-preview/pr-2916/secure-connections/sauce-connect/setup-configuration/specialized-environments"},next:{title:"CI/CD Integration",permalink:"/sauce-docs/pr-preview/pr-2916/secure-connections/sauce-connect/setup-configuration/ci-cd-integration"}},a={},l=[{value:"Running the Sauce Connect Docker Container",id:"running-the-sauce-connect-docker-container",level:2},{value:"Configuring Sauce Connect Proxy Using Environment Variables",id:"configuring-sauce-connect-proxy-using-environment-variables",level:2},{value:"Running the Sauce Connect Docker Container with a CI/CD Pipeline",id:"running-the-sauce-connect-docker-container-with-a-cicd-pipeline",level:2},{value:"Readiness Endpoint",id:"readiness-endpoint",level:3},{value:"Ready File",id:"ready-file",level:3},{value:"Orchestrating the Sauce Connect Proxy Container",id:"orchestrating-the-sauce-connect-proxy-container",level:2},{value:"Running the Sauce Connect Proxy Container Indefinitely In Kubernetes",id:"running-the-sauce-connect-proxy-container-indefinitely-in-kubernetes",level:3},{value:"Running the Sauce Connect Proxy Container Indefinitely With Docker Compose",id:"running-the-sauce-connect-proxy-container-indefinitely-with-docker-compose",level:3},{value:"Running an Application Alongside Sauce Connect Proxy",id:"running-an-application-alongside-sauce-connect-proxy",level:3},{value:"Additional Resources",id:"additional-resources",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components},{Details:o}=n;return o||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.p,{children:["As an alternative to downloading and installing the Sauce Connect Proxy in your CI/CD environment, you can leverage ",(0,c.jsx)(n.a,{href:"https://www.docker.com/",children:"Docker"})," to manage ",(0,c.jsx)(n.a,{href:"https://hub.docker.com/r/saucelabs/sauce-connect/",children:"Sauce Connect Docker container"})," maintained by the Sauce Labs ",(0,c.jsx)(n.a,{href:"https://opensource.saucelabs.com/",children:"Open Source Program Office"}),"."]}),"\n",(0,c.jsx)(n.p,{children:"Here are some benefits/use cases:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"If you want to run Sauce Connect Proxy as part of a containerized CI/CD."}),"\n",(0,c.jsx)(n.li,{children:"If you want to run Sauce Connect Proxy using container orchestration tools such as Kubernetes"}),"\n",(0,c.jsx)(n.li,{children:"If you'd prefer to manage Docker image tags instead of Sauce Connect Proxy versions."}),"\n",(0,c.jsx)(n.li,{children:"If your setup involves several instances running on the same system, Docker would simplify Sauce Connect Proxy port management."}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"running-the-sauce-connect-docker-container",children:"Running the Sauce Connect Docker Container"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Pull the Sauce Connect Proxy Docker Image from the ",(0,c.jsx)(n.a,{href:"https://hub.docker.com/r/saucelabs/sauce-connect",children:"Docker Hub"}),"."]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"To pull the latest version of Sauce Connect Proxy (recommended):"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"$ docker pull saucelabs/sauce-connect\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"To use a specific version, add it as a tag:"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"$ docker pull saucelabs/sauce-connect:4.9.2\n"})}),"\n",(0,c.jsxs)(o,{children:[(0,c.jsx)("summary",{children:"Supported tags"}),(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["4.9.2, 4.9.2-ubuntu-22.04, 4.9.2-alpine-glibc, latest",(0,c.jsx)("br",{})]}),"\n",(0,c.jsxs)(n.li,{children:["4.9.1, 4.9.1-ubuntu-22.04, 4.9.1-alpine-glibc",(0,c.jsx)("br",{})]}),"\n",(0,c.jsxs)(n.li,{children:["4.9.0, 4.9.0-ubuntu-22.04, 4.9.0-alpine-glibc",(0,c.jsx)("br",{})]}),"\n"]})]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"To run the Sauce Connect Proxy Docker image, run the script below."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'$ export SAUCE_USERNAME="my-user"\n$ export SAUCE_ACCESS_KEY="my-access-key"\ndocker run \\\n    -e SAUCE_USERNAME=${SAUCE_USERNAME} \\\n    -e SAUCE_ACCESS_KEY=${SAUCE_ACCESS_KEY} \\\n    --network="host" \\\n    -it saucelabs/sauce-connect\n'})}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["If desired, you can specify any additional ",(0,c.jsx)(n.a,{href:"/dev/cli/sauce-connect-proxy/",children:"SC CLI arguments"}),"."]}),"\n",(0,c.jsx)(n.admonition,{type:"note",children:(0,c.jsxs)(n.p,{children:["The example above uses ",(0,c.jsx)(n.code,{children:'--network="host"'})," docker option to allow Sauce Connect in the Docker container to access your local services in the host machine. This option does not work on MacOS and Windows. See ",(0,c.jsx)(n.a,{href:"https://docs.docker.com/desktop/networking/#use-cases-and-workarounds",children:"Connect from a container to a service on the macOS host"})," for more details."]})}),"\n",(0,c.jsx)(n.h2,{id:"configuring-sauce-connect-proxy-using-environment-variables",children:"Configuring Sauce Connect Proxy Using Environment Variables"}),"\n",(0,c.jsxs)(n.p,{children:["It is convenient to configure Sauce Connect Proxy Docker via ",(0,c.jsx)(n.a,{href:"/secure-connections/sauce-connect/setup-configuration/environment-variables/#command-line-options-environment-variables",children:"environment variables"})," when it is used as a Gitlab service or ",(0,c.jsx)(n.a,{href:"https://github.com/saucelabs/sauce-connect-action",children:"GitHub Action"}),"."]}),"\n",(0,c.jsx)(n.p,{children:"Below is an example of configuring Sauce Connect Proxy using environment variables. The example uses 4.8.x specific options that could not work with the previous versions."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'$ cat /tmp/sc.env\nSAUCE_REGION: eu-central\nSAUCE_API_KEY="<YOUR API KEY>"\nSAUCE_USERNAME="<YOUR USERNAME>"\nSAUCE_OUTPUT_FORMAT=text\nSAUCE_TUNNEL_POOL=true\nSAUCE_LOGFILE=-\nSAUCE_TUNNEL_NAME=my-docker-tunnel\nSAUCE_READYFILE=/tmp/sc.ready\n\n$ docker run \\\n    --env-file /tmp/sc.env \\\n    --network="host" \\\n    -v /tmp:/tmp \\\n    -t saucelabs/sauce-connect\n'})}),"\n",(0,c.jsx)(n.h2,{id:"running-the-sauce-connect-docker-container-with-a-cicd-pipeline",children:"Running the Sauce Connect Docker Container with a CI/CD Pipeline"}),"\n",(0,c.jsx)(n.p,{children:"If you want to run this Docker image as part of your CI/CD pipeline, you would need a way to determine that Sauce Connect Proxy is ready to proxy the requests. You can achieve that by:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Using the ",(0,c.jsx)(n.code,{children:"/readiness"})," endpoint, which is available effective with Sauce Connect Proxy v4.8.0"]}),"\n",(0,c.jsxs)(n.li,{children:["Using Docker's ",(0,c.jsx)(n.a,{href:"https://docs.docker.com/storage/volumes/",children:"volumes"})," feature along with our Sauce Connect Proxy ",(0,c.jsx)(n.a,{href:"/dev/cli/sauce-connect-proxy/#--readyfile",children:(0,c.jsx)(n.code,{children:"--readyfile"})})," flag."]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"readiness-endpoint",children:"Readiness Endpoint"}),"\n",(0,c.jsxs)(n.p,{children:["The readiness endpoint allows you to configure liveness and readiness HTTP probes. See the ",(0,c.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/",children:"Kubernetes documentation"})," for more information."]}),"\n",(0,c.jsx)(n.p,{children:"Docker container exposes Sauce Connect Proxy HTTP status server on port 8032. The following endpoints are available:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"/readiness"})," returns 200 response code when Sauce Connect Proxy is ready, 503 otherwise"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"/liveness"})," returns 200 response code when Sauce Connect Proxy is running"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"You can leverage the readiness endpoint in your CI/CD pipeline by running the following:"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Create a bash script ",(0,c.jsx)(n.code,{children:"wait-for-sc.sh"})," that will ensure the pipeline only continues after Sauce Connect Proxy is fully connected and ready."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",metastring:'title="wait-for-sc.sh"',children:'until [ "$(curl -s -o /dev/null -w \'\'%{http_code}\'\' localhost:8032/readiness)" == "200" ]\ndo\n    sleep 1\ndone\necho "SC ready"\n'})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Run Sauce Connect Docker container using the script below. It is important that you map port 8032 (that is, ",(0,c.jsx)(n.code,{children:"-p 8032:8032"}),") so that the port is available to the host."]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"$ docker run \\\n    --detach \\\n    -e SAUCE_USERNAME=${SAUCE_USERNAME} \\\n    -e SAUCE_ACCESS_KEY=${SAUCE_ACCESS_KEY} \\\n    -p 8032:8032 \\\n    -t saucelabs/sauce-connect:latest \\\n    -i your-docker-tunnel\n  $ ./wait-for-sc.sh\n"})}),"\n",(0,c.jsx)(n.h3,{id:"ready-file",children:"Ready File"}),"\n",(0,c.jsxs)(n.p,{children:["You can leverage the Sauce Connect Proxy ",(0,c.jsx)(n.a,{href:"/dev/cli/sauce-connect-proxy/#--readyfile",children:(0,c.jsx)(n.code,{children:"--readyfile"})})," flag to specify a file that will be created (or updated) when the proxy is ready."]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["Create a bash script ",(0,c.jsx)(n.code,{children:"wait-for-sc.sh"})," that will ensure the pipeline only continues after Sauce Connect Proxy is fully connected and ready."]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",metastring:'title="wait-for-sc.sh"',children:'until [ -f /tmp/sc.ready ]\ndo\n    sleep 1\ndone\necho "SC ready"\n'})}),"\n",(0,c.jsxs)(n.ol,{start:"2",children:["\n",(0,c.jsxs)(n.li,{children:["Run Sauce Connect Docker container using the script below. You must mount a temporary folder (",(0,c.jsx)(n.code,{children:"-v /tmp:/tmp"}),") so that ",(0,c.jsx)(n.code,{children:"wait-for-sc.sh"})," can detect when Sauce Connect is ready."]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"$ docker run \\\n    --detach \\\n    -e SAUCE_USERNAME=${SAUCE_USERNAME} \\\n    -e SAUCE_ACCESS_KEY=${SAUCE_ACCESS_KEY} \\\n    -v /tmp:/tmp \\\n    -t saucelabs/sauce-connect:latest \\\n    -f /tmp/sc.ready \\\n    -i your-docker-tunnel\n  $ ./wait-for-sc.sh\n"})}),"\n",(0,c.jsx)(n.p,{children:"Starting with Sauce Connect Proxy 4.8.0, the ready file will contain JSON-formatted information about the running Sauce Connect Proxy. For example:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'$ cat /tmp/sc.ready | jq .\n{\n  "firstConnectedTime": "2022-03-01 11:08:13",\n  "scProxyPort": "35181",\n  "tunnelID": "182de89899",\n  "tunnelName": "my-tunnel",\n  "tunnelServer": "maki76.eu-central-1.miso.saucelabs.com"\n}\n'})}),"\n",(0,c.jsx)(n.h2,{id:"orchestrating-the-sauce-connect-proxy-container",children:"Orchestrating the Sauce Connect Proxy Container"}),"\n",(0,c.jsx)(n.p,{children:"Sauce Connect Proxy Container orchestration is the automation of much of the operational effort required to run containerized Sauce Connect Proxy.\nThere are multiple container orchestration tools exist, such as Kubernetes, Docker Swarm, Google CloudRun, Amazon ECS, etc. This section provides a few examples of orchestrating containerized Sauce Connect Proxy."}),"\n",(0,c.jsx)(n.h3,{id:"running-the-sauce-connect-proxy-container-indefinitely-in-kubernetes",children:"Running the Sauce Connect Proxy Container Indefinitely In Kubernetes"}),"\n",(0,c.jsxs)(n.p,{children:["If you need a Sauce Connect Proxy to stay up indefinitely, we recommend using a ",(0,c.jsx)(n.a,{href:"https://helm.sh/docs/topics/charts/",children:"Helm chart"})," to manage your Sauce Connect Proxy instance or pool."]}),"\n",(0,c.jsxs)(n.p,{children:["The Sauce Connect Proxy Docker GitHub repository provides ",(0,c.jsx)(n.a,{href:"https://github.com/saucelabs/sauce-connect-docker/tree/main/chart/sauce-connect",children:"a reference Helm chart"})," that may be used as is, or adapted to your needs.\nTo use that chart:"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Define a values file containing your configuration, for example:"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'sauceApiRegion: us-west\nsauceUser: johndoe\nsauceApiKey: "xxx-xxx-xxx"\ntunnelName: "my-k8s-tunnel"\ntunnelPool: true\ntunnelPoolSize: 2\n'})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Run Helm install"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",metastring:'title="helm install"',children:"helm install sauce-connect  ./chart/sauce-connect --values /path/to/values.yaml\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Use the following commands in order to get the Sauce Connect Proxy application status and logs"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",metastring:'title="SC logs"',children:'$ POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=sauce-connect,app.kubernetes.io/instance=sauce-connect" -o jsonpath="{.items[0].metadata.name}")\n$ CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")\n$ kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT\n$ curl -s 127.0.0.1:8080/api/v1/status | jq .\n$ curl -s http://127.0.0.1:8080/api/v1/status | jq .\n{\n  "firstConnectedTime": 1662098351,\n  "tunnelID": "11111",\n  "tunnelName": "my-k8s-tunnel",\n  "tunnelServer": "tunnel-59569b.tunnels.us-west-1.saucelabs.com",\n  "lastStatusChange": 1662098350,\n  "reconnectCount": 0,\n  "tunnelStatus": "connected"\n}\n$ kubectl logs $POD_NAME -f\n...\n2022-08-02 02:59:11.464 [8] [CLI] [info] Connection state has changed: previous: INIT, actual: CONNECTED.\n2022-08-02 02:59:11.464 [8] [CLI] [info] Sauce Connect is up, you may start your tests.\n'})}),"\n",(0,c.jsx)(n.h3,{id:"running-the-sauce-connect-proxy-container-indefinitely-with-docker-compose",children:"Running the Sauce Connect Proxy Container Indefinitely With Docker Compose"}),"\n",(0,c.jsxs)(n.p,{children:["If you need a Sauce Connect Proxy to stay up indefinitely but you can't deploy it in Kubernetes (which is the recommended container orchestration tool), the Sauce Connect Proxy Docker GitHub repository provides an ",(0,c.jsx)(n.a,{href:"https://github.com/saucelabs/sauce-connect-docker/tree/main/examples/docker-compose-sc",children:"example docker-compose.yaml"})," that shows how to set up a set of shared Sauce Connect Pools that automatically restart when they go down."]}),"\n",(0,c.jsx)(n.h3,{id:"running-an-application-alongside-sauce-connect-proxy",children:"Running an Application Alongside Sauce Connect Proxy"}),"\n",(0,c.jsxs)(n.p,{children:["The Sauce Connect Proxy Docker GitHub repository provides an ",(0,c.jsx)(n.a,{href:"https://github.com/saucelabs/sauce-connect-docker/tree/main/examples/docker-compose-sc-nginx",children:"example docker-compose.yaml"})," that shows\nhow to run Sauce Connect Docker adjacent to an application container (an Nginx server in this example).\nThe example configuration allows you to use a tunnel while launching a Desktop or Web Mobile test, then go to the '",(0,c.jsx)(n.a,{href:"http://some-app",children:"http://some-app"}),"' URL. The Sauce Connect Proxy then routes you to the nginx container.\nYou can change the Nginx container name with ",(0,c.jsx)(n.a,{href:"https://docs.docker.com/compose/compose-file/compose-file-v3/#container_name",children:"container_name"}),"."]}),"\n",(0,c.jsx)(n.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"https://docs.docker.com/network/host/",children:"Use host networking in Docker"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"https://docs.docker.com/desktop/mac/networking/#use-cases-and-workarounds",children:"Connect from a container to a service on the macOS host"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"https://helm.sh/docs/topics/charts/",children:"Helm charts"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"https://docs.docker.com/compose/compose-file/compose-file-v3/",children:"Docker Compose File"})}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(u,{...e})}):u(e)}},28453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>i});var c=o(96540);const t={},s=c.createContext(t);function r(e){const n=c.useContext(s);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),c.createElement(s.Provider,{value:n},e.children)}}}]);